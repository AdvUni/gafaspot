{{/* 
    Copyright 2019, Advanced UniByte GmbH.
    Author Marie Lohbeck.
    
    This file is part of Gafaspot.
    
    Gafaspot is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    
    Gafaspot is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    
    You should have received a copy of the GNU General Public License
    along with Gafaspot.  If not, see <https://www.gnu.org/licenses/>.
*/}}

{{ template "top" }}
{{ template "nav" index .Username }}
<main>

    <div class="row">
        <!-- tab bar for all environments -->
        <div class="col-2">
            <div class="list-group" id="list-tab" role="tablist">
                {{ range index .Envcontent }}
                <a class="list-group-item list-group-item-action" id="{{ .Env.PlainName }}-tab" data-toggle="list"
                    href="#{{ .Env.PlainName }}" role="tab" aria-controls="{{ .Env.PlainName }}">{{ .Env.NiceName }}</a>
                {{ end }}
            </div>
        </div>
        <!-- contents to the different tabs -->
        <div class="container col-8">
            <br>
            <div class="tab-content" id="nav-tabContent">
                {{ range index .Envcontent }}
                <div class="tab-pane" id="{{ .Env.PlainName }}" role="tabpanel" aria-labelledby="{{ .Env.PlainName }}-tab">
                    <h2>{{ .Env.NiceName }}</h2>
                    <br>
                    <h3>Description:</h3>
                    <p>{{ .Env.Description }}</p>
                    <hr>
                    <h3>Reservations:</h3>
                    <br>
                    <form method="post" action="/newreservation/{{ .Env.PlainName }}">
                        <button type="submit" class="btn btn-primary">new reservation</button>
                    </form>
                    <br>
                    <ul class="list-group">
                        <!-- all upcoming reservations -->
                        {{ range .ReservationsUpcoming }}
                        <li class="list-group-item list-group-item-info">
                            <div class="row">
                                <span class="badge border border-info overflow-hidden col-md-1">upcoming</span>
                                <span class="col-md-10"><span class="font-weight-bold">{{ .User }}:</span><span
                                        class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                                        class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                            </div>
                        </li>
                        {{ end }}
                        <!-- all active reservations -->
                        {{ range .ReservationsActive }}
                        <li class="list-group-item list-group-item-success">
                            <div class="row">
                                <span class="badge border border-success col-md-1">active</span>
                                <span class="col-md-9"><span class="font-weight-bold">{{ .User }}:</span><span
                                        class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                                        class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                            </div>
                        </li>
                        {{ end }}
                        <!-- all expired reservations -->
                        {{ range .ReservationsExpired }}
                        <li class="list-group-item list-group-item-dark">
                            <div class="row">
                                <span class="badge border border-dark col-md-1">expired</span>
                                <span class="col-md-11"><span class="font-weight-bold">{{ .User }}:</span><span
                                        class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                                        class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                            </div>
                        </li>
                        {{ end }}
                    </ul>
                    <br>
                </div>
                {{ end }}
            </div>
        </div>
    </div>

</main>
{{ template "bottom" }}

<!-- functionality for accessing specified tabs when linking from another site -->
<script type="text/javascript">
    var url = document.location.toString();
    if (url.match('#')) {
        $('.list-group a[href="#' + url.split('#')[1] + '"]').tab('show');
    }
    $('.list-group a').on('shown.bs.tab', function (e) {
        window.location.hash = e.target.hash;
    })
</script>