{{ template "top" }}
{{ template "nav" index .Username }}
<main>
    <!-- confirm modal for aborting reservations -->
    <div class="modal fade" id="confirmAbortion" tabindex="-1" role="dialog" aria-labelledby="confirmAbortionTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmAbortionTitle">Want to abort reservation?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control-plaintext" readonly name="reservation" value="" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">no</button>
                    <form method="post" action="/abortreservation">
                        <input type="hidden" name="id" value="" />
                        <button type="submit" class="btn btn-primary">yes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- confirm modal for deleting ssh keys -->
    <div class="modal fade" id="confirmSSHDeletion" tabindex="-1" role="dialog"
        aria-labelledby="confirmSSHDeletionTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmSSHDeletionTitle">Want to delete SSH public key?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning" role="alert">
                        <h4 class="alert-heading">Warning</h4>
                        <p>
                            For some environments, the SSH key is necessary to perform reservations. Gafaspot will not
                            allow you to do create such a reservation without having an SSH key uploaded. But it will
                            fetch your key for the reservation not until it actually started. So, if you delete your key
                            after you created a reservation, but before the reservation started, it will cause an error.
                            The reservation will not be performed.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">no</button>
                    <a href="/personal/deletekey"><input type=button class="btn btn-primary">yes</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2> personal data </h2>

        <p><b>User:</b> {{ index .Username }}</p>
        <hr>
        <p><b>SSH public key:</b>
            {{ $noSSH := eq (index .SSHkey) "" }}
            <p class="text-monospace text-break">{{ if $noSSH }}no key yet{{ else }}{{ index .SSHkey }}{{ end }}</p>
        </p>
        <a class="btn btn-primary m-2" href="personal/addkey" role="button">add/change key</a>
        <hr>

        <div class="d-flex justify-content-end">
            <a class="btn btn-primary m-2" href="personal/addkey" role="button">add/change key</a>
            <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#confirmSSHDeletion"
                {{ if $noSSH }}disabled{{ end }}>remove key</button>
        </div>

        <a class="btn btn-success m-2" href="/personal/creds" role="button">show all your valid credentials</a>

        <h3>Your reservations:</h3>
        <ul class="list-group">
            <!-- all upcoming reservations -->
            {{ range index .ReservationsUpcoming }}
            <li class="list-group-item list-group-item-info">
                <div class="row">
                    <span class="badge border border-info overflow-hidden col-md-1">upcoming</span>
                    <span class="col-md-10"><span class="font-weight-bold">{{ .EnvNiceName }}:</span><span
                            class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                            class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                    <button type="button" class="btn badge badge-danger col-md-1" data-toggle="modal"
                        data-target="#confirmAbortion" data-id="{{ .ID }}"
                        data-reservation="{{ .EnvNiceName }}: {{ formatDatetime .Start }} &ndash; {{ formatDatetime .End }} ({{ .Subject }})">Abort
                    </button>
                </div>
            </li>
            {{ end }}
            <!-- all active reservations -->
            {{ range index .ReservationsActive }}
            <li class="list-group-item list-group-item-success">
                <div class="row">
                    <span class="badge border border-success col-md-1">active</span>
                    <span class="col-md-9"><span class="font-weight-bold">{{ .EnvNiceName }}:</span><span
                            class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                            class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                    <a href="personal/creds" class="badge badge-success col-md-2">Show credentials</a>
                </div>
            </li>
            {{ end }}
            <!-- all expired reservations -->
            {{ range index .ReservationsExpired }}
            <li class="list-group-item list-group-item-dark">
                <div class="row">
                    <span class="badge border border-dark col-md-1">expired</span>
                    <span class="col-md-11"><span class="font-weight-bold">{{ .EnvNiceName }}:</span><span
                            class="ml-3 mr-2">{{ formatDatetime .Start }}</span>&ndash;<span
                            class="ml-2 mr-3">{{ formatDatetime .End }}</span>({{ .Subject }})</span>
                </div>
            </li>
            {{ end }}
        </ul>
    </div>
</main>

{{ template "bottom" }}

<!-- functionality for passing the right data to the confirm-abortion-modal when clicking an abort button -->
<script type="text/javascript">
    $('#confirmAbortion').on('show.bs.modal', function (e) {
        $(e.currentTarget).find('input[name="reservation"]').val($(e.relatedTarget).data('reservation'));
        $(e.currentTarget).find('input[name="id"]').val($(e.relatedTarget).data('id'));
    });
</script>